name: sort
config: 
  lenient_log: true
source:
  language: lisp
  code: |
    (setq arr (alloc 5))
    (setq n 5)

    (setq i 0)
    (while (< i n)
      (if (= i 0) (aset arr 0 42)
        (if (= i 1) (aset arr 1 3)
          (if (= i 2) (aset arr 2 7)
            (if (= i 3) (aset arr 3 19)
              (aset arr 4 1)))))
      (setq i (+ i 1))
    )

    (setq i 0)
    (while (< i n)
      (setq j 0)
      (while (< j (- n i 1))
        (setq x (aget arr j))
        (setq y (aget arr (+ j 1)))
        (if (> x y)
          (progn
            (aset arr j y)
            (aset arr (+ j 1) x)
          )
        )
        (setq j (+ j 1))
      )
      (setq i (+ i 1))
    )

    (setq k 0)
    (while (< k n)
      (setq v (aget arr k))
      (print v)
      (if (< (+ k 1) n) (print " "))
      (setq k (+ k 1))
    )
    (print "\n")

expect:
  output: |
    1 3 7 19 42
  state: stopped
  error: false
  out_code: !!binary |
    BQAAAFQAAAAABAAAFgAAAAUAAAAKAAAAAQQAABYAAAAAAAAACgAAAAIEAAAWAAAAAgQAABUAAAAAAAAAPAAAAAEEAAAVAAAAAwAAAFsAAAA4AgAAHwAAAAIEAAAVAAAAAAAAADwAAAAAAAAACgAAAAEAAABbAAAAuAAAAB8AAAAABAAAFQAAAAAAAAA8AAAAAAAAAAoAAAAAAAAAPAAAACoAAAAKAAAAAAAAAFUAAAAIAgAAHgAAAAIEAAAVAAAAAAAAADwAAAABAAAACgAAAAEAAABbAAAAGAEAAB8AAAAABAAAFQAAAAAAAAA8AAAAAQAAAAoAAAAAAAAAPAAAAAMAAAAKAAAAAAAAAFUAAAAIAgAAHgAAAAIEAAAVAAAAAAAAADwAAAACAAAACgAAAAEAAABbAAAAeAEAAB8AAAAABAAAFQAAAAAAAAA8AAAAAgAAAAoAAAAAAAAAPAAAAAcAAAAKAAAAAAAAAFUAAAAIAgAAHgAAAAIEAAAVAAAAAAAAADwAAAADAAAACgAAAAEAAABbAAAA2AEAAB8AAAAABAAAFQAAAAAAAAA8AAAAAwAAAAoAAAAAAAAAPAAAABMAAAAKAAAAAAAAAFUAAAAIAgAAHgAAAAAEAAAVAAAAAAAAADwAAAAEAAAACgAAAAAAAAA8AAAAAQAAAAoAAAAAAAAAVQAAAAIEAAAVAAAAAAAAADwAAAABAAAACgAAAAEAAABaAAAAAgQAABYAAAAwAAAAHgAAAAAAAAAKAAAAAgQAABYAAAACBAAAFQAAAAAAAAA8AAAAAQQAABUAAAADAAAAWwAAAFgEAAAfAAAAAAAAAAoAAAADBAAAFgAAAAMEAAAVAAAAAAAAADwAAAABBAAAFQAAAAAAAAA8AAAAAgQAABUAAAACAAAAWgAAAAAAAAA8AAAAAQAAAAoAAAACAAAAWgAAAAMAAABbAAAAKAQAAB8AAAAABAAAFQAAAAAAAAA8AAAAAwQAABUAAAAAAAAAPAAAAAAAAABWAAAABAQAABYAAAAABAAAFQAAAAAAAAA8AAAAAwQAABUAAAAAAAAAPAAAAAEAAAAKAAAAAQAAAFoAAAAAAAAAPAAAAAAAAABWAAAABQQAABYAAAAEBAAAFQAAAAAAAAA8AAAABQQAABUAAAAFAAAAWwAAAPgDAAAfAAAAAAQAABUAAAAAAAAAPAAAAAMEAAAVAAAAAAAAADwAAAAFBAAAFQAAAAAAAABVAAAAAAQAABUAAAAAAAAAPAAAAAMEAAAVAAAAAAAAADwAAAABAAAACgAAAAEAAABaAAAAAAAAADwAAAAEBAAAFQAAAAAAAABVAAAA+AMAAB4AAAADBAAAFQAAAAAAAAA8AAAAAQAAAAoAAAABAAAAWgAAAAMEAAAWAAAAgAIAAB4AAAACBAAAFQAAAAAAAAA8AAAAAQAAAAoAAAABAAAAWgAAAAIEAAAWAAAASAIAAB4AAAAAAAAACgAAAAYEAAAWAAAABgQAABUAAAAAAAAAPAAAAAEEAAAVAAAAAwAAAFsAAABYBQAAHwAAAAAEAAAVAAAAAAAAADwAAAAGBAAAFQAAAAAAAAA8AAAAAAAAAFYAAAAHBAAAFgAAAAcEAAAVAAAAAAAAAEYAAAAGBAAAFQAAAAAAAAA8AAAAAQAAAAoAAAABAAAAWgAAAAAAAAA8AAAAAQQAABUAAAADAAAAWwAAACgFAAAfAAAAAAAAABQAAAAAAAAARgAAACgFAAAeAAAABgQAABUAAAAAAAAAPAAAAAEAAAAKAAAAAQAAAFoAAAAGBAAAFgAAAGgEAAAeAAAAAgAAABQAAAAAAAAARgAAAAAAAAABAAAA
  out_code_hex: |-
    0 - 0500000054000000 - ALLOC 5
    8 - 0004000016000000 - STORE_MEM 1024
    16 - 050000000A000000 - LOAD_IMM 5
    24 - 0104000016000000 - STORE_MEM 1025
    32 - 000000000A000000 - LOAD_IMM 0
    40 - 0204000016000000 - STORE_MEM 1026
    48 - 0204000015000000 - LOAD_MEM 1026
    56 - 000000003C000000 - PUSH_IMM 0
    64 - 0104000015000000 - LOAD_MEM 1025
    72 - 030000005B000000 - CMP_POP 3
    80 - 380200001F000000 - BEQZ 568
    88 - 0204000015000000 - LOAD_MEM 1026
    96 - 000000003C000000 - PUSH_IMM 0
    104 - 000000000A000000 - LOAD_IMM 0
    112 - 010000005B000000 - CMP_POP 1
    120 - B80000001F000000 - BEQZ 184
    128 - 0004000015000000 - LOAD_MEM 1024
    136 - 000000003C000000 - PUSH_IMM 0
    144 - 000000000A000000 - LOAD_IMM 0
    152 - 000000003C000000 - PUSH_IMM 0
    160 - 2A0000000A000000 - LOAD_IMM 42
    168 - 0000000055000000 - ASET 0
    176 - 080200001E000000 - JMP 520
    184 - 0204000015000000 - LOAD_MEM 1026
    192 - 000000003C000000 - PUSH_IMM 0
    200 - 010000000A000000 - LOAD_IMM 1
    208 - 010000005B000000 - CMP_POP 1
    216 - 180100001F000000 - BEQZ 280
    224 - 0004000015000000 - LOAD_MEM 1024
    232 - 000000003C000000 - PUSH_IMM 0
    240 - 010000000A000000 - LOAD_IMM 1
    248 - 000000003C000000 - PUSH_IMM 0
    256 - 030000000A000000 - LOAD_IMM 3
    264 - 0000000055000000 - ASET 0
    272 - 080200001E000000 - JMP 520
    280 - 0204000015000000 - LOAD_MEM 1026
    288 - 000000003C000000 - PUSH_IMM 0
    296 - 020000000A000000 - LOAD_IMM 2
    304 - 010000005B000000 - CMP_POP 1
    312 - 780100001F000000 - BEQZ 376
    320 - 0004000015000000 - LOAD_MEM 1024
    328 - 000000003C000000 - PUSH_IMM 0
    336 - 020000000A000000 - LOAD_IMM 2
    344 - 000000003C000000 - PUSH_IMM 0
    352 - 070000000A000000 - LOAD_IMM 7
    360 - 0000000055000000 - ASET 0
    368 - 080200001E000000 - JMP 520
    376 - 0204000015000000 - LOAD_MEM 1026
    384 - 000000003C000000 - PUSH_IMM 0
    392 - 030000000A000000 - LOAD_IMM 3
    400 - 010000005B000000 - CMP_POP 1
    408 - D80100001F000000 - BEQZ 472
    416 - 0004000015000000 - LOAD_MEM 1024
    424 - 000000003C000000 - PUSH_IMM 0
    432 - 030000000A000000 - LOAD_IMM 3
    440 - 000000003C000000 - PUSH_IMM 0
    448 - 130000000A000000 - LOAD_IMM 19
    456 - 0000000055000000 - ASET 0
    464 - 080200001E000000 - JMP 520
    472 - 0004000015000000 - LOAD_MEM 1024
    480 - 000000003C000000 - PUSH_IMM 0
    488 - 040000000A000000 - LOAD_IMM 4
    496 - 000000003C000000 - PUSH_IMM 0
    504 - 010000000A000000 - LOAD_IMM 1
    512 - 0000000055000000 - ASET 0
    520 - 0204000015000000 - LOAD_MEM 1026
    528 - 000000003C000000 - PUSH_IMM 0
    536 - 010000000A000000 - LOAD_IMM 1
    544 - 010000005A000000 - BINOP_POP 1
    552 - 0204000016000000 - STORE_MEM 1026
    560 - 300000001E000000 - JMP 48
    568 - 000000000A000000 - LOAD_IMM 0
    576 - 0204000016000000 - STORE_MEM 1026
    584 - 0204000015000000 - LOAD_MEM 1026
    592 - 000000003C000000 - PUSH_IMM 0
    600 - 0104000015000000 - LOAD_MEM 1025
    608 - 030000005B000000 - CMP_POP 3
    616 - 580400001F000000 - BEQZ 1112
    624 - 000000000A000000 - LOAD_IMM 0
    632 - 0304000016000000 - STORE_MEM 1027
    640 - 0304000015000000 - LOAD_MEM 1027
    648 - 000000003C000000 - PUSH_IMM 0
    656 - 0104000015000000 - LOAD_MEM 1025
    664 - 000000003C000000 - PUSH_IMM 0
    672 - 0204000015000000 - LOAD_MEM 1026
    680 - 020000005A000000 - BINOP_POP 2
    688 - 000000003C000000 - PUSH_IMM 0
    696 - 010000000A000000 - LOAD_IMM 1
    704 - 020000005A000000 - BINOP_POP 2
    712 - 030000005B000000 - CMP_POP 3
    720 - 280400001F000000 - BEQZ 1064
    728 - 0004000015000000 - LOAD_MEM 1024
    736 - 000000003C000000 - PUSH_IMM 0
    744 - 0304000015000000 - LOAD_MEM 1027
    752 - 000000003C000000 - PUSH_IMM 0
    760 - 0000000056000000 - AGET 0
    768 - 0404000016000000 - STORE_MEM 1028
    776 - 0004000015000000 - LOAD_MEM 1024
    784 - 000000003C000000 - PUSH_IMM 0
    792 - 0304000015000000 - LOAD_MEM 1027
    800 - 000000003C000000 - PUSH_IMM 0
    808 - 010000000A000000 - LOAD_IMM 1
    816 - 010000005A000000 - BINOP_POP 1
    824 - 000000003C000000 - PUSH_IMM 0
    832 - 0000000056000000 - AGET 0
    840 - 0504000016000000 - STORE_MEM 1029
    848 - 0404000015000000 - LOAD_MEM 1028
    856 - 000000003C000000 - PUSH_IMM 0
    864 - 0504000015000000 - LOAD_MEM 1029
    872 - 050000005B000000 - CMP_POP 5
    880 - F80300001F000000 - BEQZ 1016
    888 - 0004000015000000 - LOAD_MEM 1024
    896 - 000000003C000000 - PUSH_IMM 0
    904 - 0304000015000000 - LOAD_MEM 1027
    912 - 000000003C000000 - PUSH_IMM 0
    920 - 0504000015000000 - LOAD_MEM 1029
    928 - 0000000055000000 - ASET 0
    936 - 0004000015000000 - LOAD_MEM 1024
    944 - 000000003C000000 - PUSH_IMM 0
    952 - 0304000015000000 - LOAD_MEM 1027
    960 - 000000003C000000 - PUSH_IMM 0
    968 - 010000000A000000 - LOAD_IMM 1
    976 - 010000005A000000 - BINOP_POP 1
    984 - 000000003C000000 - PUSH_IMM 0
    992 - 0404000015000000 - LOAD_MEM 1028
    1000 - 0000000055000000 - ASET 0
    1008 - F80300001E000000 - JMP 1016
    1016 - 0304000015000000 - LOAD_MEM 1027
    1024 - 000000003C000000 - PUSH_IMM 0
    1032 - 010000000A000000 - LOAD_IMM 1
    1040 - 010000005A000000 - BINOP_POP 1
    1048 - 0304000016000000 - STORE_MEM 1027
    1056 - 800200001E000000 - JMP 640
    1064 - 0204000015000000 - LOAD_MEM 1026
    1072 - 000000003C000000 - PUSH_IMM 0
    1080 - 010000000A000000 - LOAD_IMM 1
    1088 - 010000005A000000 - BINOP_POP 1
    1096 - 0204000016000000 - STORE_MEM 1026
    1104 - 480200001E000000 - JMP 584
    1112 - 000000000A000000 - LOAD_IMM 0
    1120 - 0604000016000000 - STORE_MEM 1030
    1128 - 0604000015000000 - LOAD_MEM 1030
    1136 - 000000003C000000 - PUSH_IMM 0
    1144 - 0104000015000000 - LOAD_MEM 1025
    1152 - 030000005B000000 - CMP_POP 3
    1160 - 580500001F000000 - BEQZ 1368
    1168 - 0004000015000000 - LOAD_MEM 1024
    1176 - 000000003C000000 - PUSH_IMM 0
    1184 - 0604000015000000 - LOAD_MEM 1030
    1192 - 000000003C000000 - PUSH_IMM 0
    1200 - 0000000056000000 - AGET 0
    1208 - 0704000016000000 - STORE_MEM 1031
    1216 - 0704000015000000 - LOAD_MEM 1031
    1224 - 0000000046000000 - PRINT
    1232 - 0604000015000000 - LOAD_MEM 1030
    1240 - 000000003C000000 - PUSH_IMM 0
    1248 - 010000000A000000 - LOAD_IMM 1
    1256 - 010000005A000000 - BINOP_POP 1
    1264 - 000000003C000000 - PUSH_IMM 0
    1272 - 0104000015000000 - LOAD_MEM 1025
    1280 - 030000005B000000 - CMP_POP 3
    1288 - 280500001F000000 - BEQZ 1320
    1296 - 0000000014000000 - LOAD_CONST 0
    1304 - 0000000046000000 - PRINT
    1312 - 280500001E000000 - JMP 1320
    1320 - 0604000015000000 - LOAD_MEM 1030
    1328 - 000000003C000000 - PUSH_IMM 0
    1336 - 010000000A000000 - LOAD_IMM 1
    1344 - 010000005A000000 - BINOP_POP 1
    1352 - 0604000016000000 - STORE_MEM 1030
    1360 - 680400001E000000 - JMP 1128
    1368 - 0200000014000000 - LOAD_CONST 2
    1376 - 0000000046000000 - PRINT
    1384 - 0000000001000000 - HALT
  out_log: |
    DEBUG root:processor.py:251 Datapath: heap_ptr initialized to word 1380
    DEBUG root:processor.py:720 No more scheduled input and mmio_in_buffer empty -> input closed (EOF)
    DEBUG root:processor.py:1155 ALLOC: allocated 5 words at base 1380 (new heap_ptr=1385)
    DEBUG root:processor.py:1176 ASET: wrote ACC=42 to word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1176 ASET: wrote ACC=3 to word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1176 ASET: wrote ACC=7 to word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1176 ASET: wrote ACC=19 to word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1176 ASET: wrote ACC=1 to word 1384 (base=1380 idx=4)
    DEBUG root:processor.py:1197 AGET: loaded ACC=42 from word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1197 AGET: loaded ACC=3 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1176 ASET: wrote ACC=3 to word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1176 ASET: wrote ACC=42 to word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=42 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1176 ASET: wrote ACC=7 to word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1176 ASET: wrote ACC=42 to word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1197 AGET: loaded ACC=42 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1197 AGET: loaded ACC=19 from word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1176 ASET: wrote ACC=19 to word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1176 ASET: wrote ACC=42 to word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1197 AGET: loaded ACC=42 from word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1197 AGET: loaded ACC=1 from word 1384 (base=1380 idx=4)
    DEBUG root:processor.py:1176 ASET: wrote ACC=1 to word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1176 ASET: wrote ACC=42 to word 1384 (base=1380 idx=4)
    DEBUG root:processor.py:1197 AGET: loaded ACC=3 from word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=19 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1197 AGET: loaded ACC=19 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1197 AGET: loaded ACC=1 from word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1176 ASET: wrote ACC=1 to word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1176 ASET: wrote ACC=19 to word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1197 AGET: loaded ACC=3 from word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=1 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1176 ASET: wrote ACC=1 to word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1176 ASET: wrote ACC=7 to word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1197 AGET: loaded ACC=3 from word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1197 AGET: loaded ACC=1 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1176 ASET: wrote ACC=1 to word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1176 ASET: wrote ACC=3 to word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1197 AGET: loaded ACC=1 from word 1380 (base=1380 idx=0)
    DEBUG root:processor.py:1235 PRINT: numeric -> 1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1197 AGET: loaded ACC=3 from word 1381 (base=1380 idx=1)
    DEBUG root:processor.py:1235 PRINT: numeric -> 3
    DEBUG root:processor.py:381 [MMIO OUT] wrote 51 -> char: 3
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1197 AGET: loaded ACC=7 from word 1382 (base=1380 idx=2)
    DEBUG root:processor.py:1235 PRINT: numeric -> 7
    DEBUG root:processor.py:381 [MMIO OUT] wrote 55 -> char: 7
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1197 AGET: loaded ACC=19 from word 1383 (base=1380 idx=3)
    DEBUG root:processor.py:1235 PRINT: numeric -> 19
    DEBUG root:processor.py:381 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 57 -> char: 9
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1197 AGET: loaded ACC=42 from word 1384 (base=1380 idx=4)
    DEBUG root:processor.py:1235 PRINT: numeric -> 42
    DEBUG root:processor.py:381 [MMIO OUT] wrote 52 -> char: 4
    DEBUG root:processor.py:381 [MMIO OUT] wrote 50 -> char: 2
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 2 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 10 -> char: 

    DEBUG root:processor.py:829 HALT encountered

