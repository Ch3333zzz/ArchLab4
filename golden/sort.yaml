name: sort
config: 
  lenient_log: true
source:
  language: lisp
  code: |
    (setq arr (alloc 5))
    (setq n 5)

    (setq i 0)
    (while (< i n)
      (if (= i 0) (aset arr 0 42)
        (if (= i 1) (aset arr 1 3)
          (if (= i 2) (aset arr 2 7)
            (if (= i 3) (aset arr 3 19)
              (aset arr 4 1)))))
      (setq i (+ i 1))
    )

    (setq i 0)
    (while (< i n)
      (setq j 0)
      (while (< j (- n i 1))
        (setq x (aget arr j))
        (setq y (aget arr (+ j 1)))
        (if (> x y)
          (progn
            (aset arr j y)
            (aset arr (+ j 1) x)
          )
        )
        (setq j (+ j 1))
      )
      (setq i (+ i 1))
    )

    (setq k 0)
    (while (< k n)
      (setq v (aget arr k))
      (print v)
      (if (< (+ k 1) n) (print " "))
      (setq k (+ k 1))
    )
    (print "\n")

expect:
  output: |
    1 3 7 19 42
  state: stopped
  error: false
  out_code: !!binary |
    VAUAAAAWAAQAAAoFAAAAFgEEAAAKAAAAABYCBAAAFQIEAAA8AAAAABUBBAAAWwMAAAAfYwEAABUCBAAAPAAAAAAKAAAAAFsBAAAAH3MAAAAVAAQAADwAAAAACgAAAAA8AAAAAAoqAAAAVQAAAAAeRQEAABUCBAAAPAAAAAAKAQAAAFsBAAAAH68AAAAVAAQAADwAAAAACgEAAAA8AAAAAAoDAAAAVQAAAAAeRQEAABUCBAAAPAAAAAAKAgAAAFsBAAAAH+sAAAAVAAQAADwAAAAACgIAAAA8AAAAAAoHAAAAVQAAAAAeRQEAABUCBAAAPAAAAAAKAwAAAFsBAAAAHycBAAAVAAQAADwAAAAACgMAAAA8AAAAAAoTAAAAVQAAAAAeRQEAABUABAAAPAAAAAAKBAAAADwAAAAACgEAAABVAAAAABUCBAAAPAAAAAAKAQAAAFoBAAAAFgIEAAAeHgAAAAoAAAAAFgIEAAAVAgQAADwAAAAAFQEEAABbAwAAAB+3AgAACgAAAAAWAwQAABUDBAAAPAAAAAAVAQQAADwAAAAAFQIEAABaAgAAADwAAAAACgEAAABaAgAAAFsDAAAAH5kCAAAVAAQAADwAAAAAFQMEAAA8AAAAAFYAAAAAFgQEAAAVAAQAADwAAAAAFQMEAAA8AAAAAAoBAAAAWgEAAAA8AAAAAFYAAAAAFgUEAAAVBAQAADwAAAAAFQUEAABbBQAAAB97AgAAFQAEAAA8AAAAABUDBAAAPAAAAAAVBQQAAFUAAAAAFQAEAAA8AAAAABUDBAAAPAAAAAAKAQAAAFoBAAAAPAAAAAAVBAQAAFUAAAAAHnsCAAAVAwQAADwAAAAACgEAAABaAQAAABYDBAAAHpABAAAVAgQAADwAAAAACgEAAABaAQAAABYCBAAAHm0BAAAKAAAAABYGBAAAFQYEAAA8AAAAABUBBAAAWwMAAAAfVwMAABUABAAAPAAAAAAVBgQAADwAAAAAVgAAAAAWBwQAABUHBAAARgAAAAAVBgQAADwAAAAACgEAAABaAQAAADwAAAAAFQEEAABbAwAAAB85AwAAFAAAAABGAAAAAB45AwAAFQYEAAA8AAAAAAoBAAAAWgEAAAAWBgQAAB7BAgAAFAIAAABGAAAAAAEAAAAA
  out_code_hex: |-
    0 - 5405000000 - ALLOC 5
    5 - 1600040000 - STORE_MEM 1024
    10 - 0A05000000 - LOAD_IMM 5
    15 - 1601040000 - STORE_MEM 1025
    20 - 0A00000000 - LOAD_IMM 0
    25 - 1602040000 - STORE_MEM 1026
    30 - 1502040000 - LOAD_MEM 1026
    35 - 3C00000000 - PUSH_IMM 0
    40 - 1501040000 - LOAD_MEM 1025
    45 - 5B03000000 - CMP_POP 3
    50 - 1F63010000 - BEQZ 355
    55 - 1502040000 - LOAD_MEM 1026
    60 - 3C00000000 - PUSH_IMM 0
    65 - 0A00000000 - LOAD_IMM 0
    70 - 5B01000000 - CMP_POP 1
    75 - 1F73000000 - BEQZ 115
    80 - 1500040000 - LOAD_MEM 1024
    85 - 3C00000000 - PUSH_IMM 0
    90 - 0A00000000 - LOAD_IMM 0
    95 - 3C00000000 - PUSH_IMM 0
    100 - 0A2A000000 - LOAD_IMM 42
    105 - 5500000000 - ASET 0
    110 - 1E45010000 - JMP 325
    115 - 1502040000 - LOAD_MEM 1026
    120 - 3C00000000 - PUSH_IMM 0
    125 - 0A01000000 - LOAD_IMM 1
    130 - 5B01000000 - CMP_POP 1
    135 - 1FAF000000 - BEQZ 175
    140 - 1500040000 - LOAD_MEM 1024
    145 - 3C00000000 - PUSH_IMM 0
    150 - 0A01000000 - LOAD_IMM 1
    155 - 3C00000000 - PUSH_IMM 0
    160 - 0A03000000 - LOAD_IMM 3
    165 - 5500000000 - ASET 0
    170 - 1E45010000 - JMP 325
    175 - 1502040000 - LOAD_MEM 1026
    180 - 3C00000000 - PUSH_IMM 0
    185 - 0A02000000 - LOAD_IMM 2
    190 - 5B01000000 - CMP_POP 1
    195 - 1FEB000000 - BEQZ 235
    200 - 1500040000 - LOAD_MEM 1024
    205 - 3C00000000 - PUSH_IMM 0
    210 - 0A02000000 - LOAD_IMM 2
    215 - 3C00000000 - PUSH_IMM 0
    220 - 0A07000000 - LOAD_IMM 7
    225 - 5500000000 - ASET 0
    230 - 1E45010000 - JMP 325
    235 - 1502040000 - LOAD_MEM 1026
    240 - 3C00000000 - PUSH_IMM 0
    245 - 0A03000000 - LOAD_IMM 3
    250 - 5B01000000 - CMP_POP 1
    255 - 1F27010000 - BEQZ 295
    260 - 1500040000 - LOAD_MEM 1024
    265 - 3C00000000 - PUSH_IMM 0
    270 - 0A03000000 - LOAD_IMM 3
    275 - 3C00000000 - PUSH_IMM 0
    280 - 0A13000000 - LOAD_IMM 19
    285 - 5500000000 - ASET 0
    290 - 1E45010000 - JMP 325
    295 - 1500040000 - LOAD_MEM 1024
    300 - 3C00000000 - PUSH_IMM 0
    305 - 0A04000000 - LOAD_IMM 4
    310 - 3C00000000 - PUSH_IMM 0
    315 - 0A01000000 - LOAD_IMM 1
    320 - 5500000000 - ASET 0
    325 - 1502040000 - LOAD_MEM 1026
    330 - 3C00000000 - PUSH_IMM 0
    335 - 0A01000000 - LOAD_IMM 1
    340 - 5A01000000 - BINOP_POP 1
    345 - 1602040000 - STORE_MEM 1026
    350 - 1E1E000000 - JMP 30
    355 - 0A00000000 - LOAD_IMM 0
    360 - 1602040000 - STORE_MEM 1026
    365 - 1502040000 - LOAD_MEM 1026
    370 - 3C00000000 - PUSH_IMM 0
    375 - 1501040000 - LOAD_MEM 1025
    380 - 5B03000000 - CMP_POP 3
    385 - 1FB7020000 - BEQZ 695
    390 - 0A00000000 - LOAD_IMM 0
    395 - 1603040000 - STORE_MEM 1027
    400 - 1503040000 - LOAD_MEM 1027
    405 - 3C00000000 - PUSH_IMM 0
    410 - 1501040000 - LOAD_MEM 1025
    415 - 3C00000000 - PUSH_IMM 0
    420 - 1502040000 - LOAD_MEM 1026
    425 - 5A02000000 - BINOP_POP 2
    430 - 3C00000000 - PUSH_IMM 0
    435 - 0A01000000 - LOAD_IMM 1
    440 - 5A02000000 - BINOP_POP 2
    445 - 5B03000000 - CMP_POP 3
    450 - 1F99020000 - BEQZ 665
    455 - 1500040000 - LOAD_MEM 1024
    460 - 3C00000000 - PUSH_IMM 0
    465 - 1503040000 - LOAD_MEM 1027
    470 - 3C00000000 - PUSH_IMM 0
    475 - 5600000000 - AGET 0
    480 - 1604040000 - STORE_MEM 1028
    485 - 1500040000 - LOAD_MEM 1024
    490 - 3C00000000 - PUSH_IMM 0
    495 - 1503040000 - LOAD_MEM 1027
    500 - 3C00000000 - PUSH_IMM 0
    505 - 0A01000000 - LOAD_IMM 1
    510 - 5A01000000 - BINOP_POP 1
    515 - 3C00000000 - PUSH_IMM 0
    520 - 5600000000 - AGET 0
    525 - 1605040000 - STORE_MEM 1029
    530 - 1504040000 - LOAD_MEM 1028
    535 - 3C00000000 - PUSH_IMM 0
    540 - 1505040000 - LOAD_MEM 1029
    545 - 5B05000000 - CMP_POP 5
    550 - 1F7B020000 - BEQZ 635
    555 - 1500040000 - LOAD_MEM 1024
    560 - 3C00000000 - PUSH_IMM 0
    565 - 1503040000 - LOAD_MEM 1027
    570 - 3C00000000 - PUSH_IMM 0
    575 - 1505040000 - LOAD_MEM 1029
    580 - 5500000000 - ASET 0
    585 - 1500040000 - LOAD_MEM 1024
    590 - 3C00000000 - PUSH_IMM 0
    595 - 1503040000 - LOAD_MEM 1027
    600 - 3C00000000 - PUSH_IMM 0
    605 - 0A01000000 - LOAD_IMM 1
    610 - 5A01000000 - BINOP_POP 1
    615 - 3C00000000 - PUSH_IMM 0
    620 - 1504040000 - LOAD_MEM 1028
    625 - 5500000000 - ASET 0
    630 - 1E7B020000 - JMP 635
    635 - 1503040000 - LOAD_MEM 1027
    640 - 3C00000000 - PUSH_IMM 0
    645 - 0A01000000 - LOAD_IMM 1
    650 - 5A01000000 - BINOP_POP 1
    655 - 1603040000 - STORE_MEM 1027
    660 - 1E90010000 - JMP 400
    665 - 1502040000 - LOAD_MEM 1026
    670 - 3C00000000 - PUSH_IMM 0
    675 - 0A01000000 - LOAD_IMM 1
    680 - 5A01000000 - BINOP_POP 1
    685 - 1602040000 - STORE_MEM 1026
    690 - 1E6D010000 - JMP 365
    695 - 0A00000000 - LOAD_IMM 0
    700 - 1606040000 - STORE_MEM 1030
    705 - 1506040000 - LOAD_MEM 1030
    710 - 3C00000000 - PUSH_IMM 0
    715 - 1501040000 - LOAD_MEM 1025
    720 - 5B03000000 - CMP_POP 3
    725 - 1F57030000 - BEQZ 855
    730 - 1500040000 - LOAD_MEM 1024
    735 - 3C00000000 - PUSH_IMM 0
    740 - 1506040000 - LOAD_MEM 1030
    745 - 3C00000000 - PUSH_IMM 0
    750 - 5600000000 - AGET 0
    755 - 1607040000 - STORE_MEM 1031
    760 - 1507040000 - LOAD_MEM 1031
    765 - 4600000000 - PRINT
    770 - 1506040000 - LOAD_MEM 1030
    775 - 3C00000000 - PUSH_IMM 0
    780 - 0A01000000 - LOAD_IMM 1
    785 - 5A01000000 - BINOP_POP 1
    790 - 3C00000000 - PUSH_IMM 0
    795 - 1501040000 - LOAD_MEM 1025
    800 - 5B03000000 - CMP_POP 3
    805 - 1F39030000 - BEQZ 825
    810 - 1400000000 - LOAD_CONST 0
    815 - 4600000000 - PRINT
    820 - 1E39030000 - JMP 825
    825 - 1506040000 - LOAD_MEM 1030
    830 - 3C00000000 - PUSH_IMM 0
    835 - 0A01000000 - LOAD_IMM 1
    840 - 5A01000000 - BINOP_POP 1
    845 - 1606040000 - STORE_MEM 1030
    850 - 1EC1020000 - JMP 705
    855 - 1402000000 - LOAD_CONST 2
    860 - 4600000000 - PRINT
    865 - 0100000000 - HALT
  out_log: |
    DEBUG root:processor.py:197 Datapath: heap_ptr initialized to word 1249
    DEBUG root:processor.py:616 No more scheduled input and mmio_in_buffer empty -> input closed (EOF)
    DEBUG root:processor.py:1016 ALLOC: allocated 5 words at base 1249 (new heap_ptr=1254)
    DEBUG root:processor.py:1037 ASET: wrote ACC=42 to word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1037 ASET: wrote ACC=3 to word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1037 ASET: wrote ACC=7 to word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1037 ASET: wrote ACC=19 to word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1037 ASET: wrote ACC=1 to word 1253 (base=1249 idx=4)
    DEBUG root:processor.py:1058 AGET: loaded ACC=42 from word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1058 AGET: loaded ACC=3 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1037 ASET: wrote ACC=3 to word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1037 ASET: wrote ACC=42 to word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=42 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1037 ASET: wrote ACC=7 to word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1037 ASET: wrote ACC=42 to word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1058 AGET: loaded ACC=42 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1058 AGET: loaded ACC=19 from word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1037 ASET: wrote ACC=19 to word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1037 ASET: wrote ACC=42 to word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1058 AGET: loaded ACC=42 from word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1058 AGET: loaded ACC=1 from word 1253 (base=1249 idx=4)
    DEBUG root:processor.py:1037 ASET: wrote ACC=1 to word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1037 ASET: wrote ACC=42 to word 1253 (base=1249 idx=4)
    DEBUG root:processor.py:1058 AGET: loaded ACC=3 from word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=19 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1058 AGET: loaded ACC=19 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1058 AGET: loaded ACC=1 from word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1037 ASET: wrote ACC=1 to word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1037 ASET: wrote ACC=19 to word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1058 AGET: loaded ACC=3 from word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=1 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1037 ASET: wrote ACC=1 to word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1037 ASET: wrote ACC=7 to word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1058 AGET: loaded ACC=3 from word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1058 AGET: loaded ACC=1 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1037 ASET: wrote ACC=1 to word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1037 ASET: wrote ACC=3 to word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1058 AGET: loaded ACC=1 from word 1249 (base=1249 idx=0)
    DEBUG root:processor.py:1096 PRINT: numeric -> 1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:1087 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1058 AGET: loaded ACC=3 from word 1250 (base=1249 idx=1)
    DEBUG root:processor.py:1096 PRINT: numeric -> 3
    DEBUG root:processor.py:320 [MMIO OUT] wrote 51 -> char: 3
    DEBUG root:processor.py:1087 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1058 AGET: loaded ACC=7 from word 1251 (base=1249 idx=2)
    DEBUG root:processor.py:1096 PRINT: numeric -> 7
    DEBUG root:processor.py:320 [MMIO OUT] wrote 55 -> char: 7
    DEBUG root:processor.py:1087 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1058 AGET: loaded ACC=19 from word 1252 (base=1249 idx=3)
    DEBUG root:processor.py:1096 PRINT: numeric -> 19
    DEBUG root:processor.py:320 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 57 -> char: 9
    DEBUG root:processor.py:1087 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1058 AGET: loaded ACC=42 from word 1253 (base=1249 idx=4)
    DEBUG root:processor.py:1096 PRINT: numeric -> 42
    DEBUG root:processor.py:320 [MMIO OUT] wrote 52 -> char: 4
    DEBUG root:processor.py:320 [MMIO OUT] wrote 50 -> char: 2
    DEBUG root:processor.py:1087 PRINT: Detected pstr at 2 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 10 -> char: 

    DEBUG root:processor.py:725 HALT encountered
