name: pause-test
config:
  pause_tick: 3
source:
  language: lisp
  code: |
    (print "A")
    (print "B")
    (print "C")
expect:
  out_stdout: A
  state: paused
  out_code: !!binary |
    AAAAABQAAAAAAAAARgAAAAIAAAAUAAAAAAAAAEYAAAAEAAAAFAAAAAAAAABGAAAAAAAAAAEAAAA=
  out_code_hex: |-
    0 - 0000000014000000 - LOAD_CONST 0
    8 - 0000000046000000 - PRINT
    16 - 0200000014000000 - LOAD_CONST 2
    24 - 0000000046000000 - PRINT
    32 - 0400000014000000 - LOAD_CONST 4
    40 - 0000000046000000 - PRINT
    48 - 0000000001000000 - HALT
  out_log: |
    DEBUG root:processor.py:251 Datapath: heap_ptr initialized to word 1038
    DEBUG root:processor.py:720 No more scheduled input and mmio_in_buffer empty -> input closed (EOF)
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: COMMAND_FETCH   TICK:    0 PC:  4096 ADDR:     0 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: fetch
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: OPERAND_FETCH   TICK:    0 PC:  4096 ADDR:     0 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: LOAD_CONST 0
    DEBUG root:processor.py:798 Tick 0 PC 4096: LOAD_CONST 0 ACC=0 SP=64192 FSP=64512 CP=65536
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: EXECUTION       TICK:    0 PC:  4104 ADDR:     2 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: LOAD_CONST 0
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: COMMAND_FETCH   TICK:    1 PC:  4104 ADDR:     2 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: fetch
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: OPERAND_FETCH   TICK:    1 PC:  4104 ADDR:     2 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: PRINT
    DEBUG root:processor.py:798 Tick 1 PC 4104: PRINT 0 ACC=0 SP=64192 FSP=64512 CP=65536
    DEBUG root:processor.py:1226 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:381 [MMIO OUT] wrote 65 -> char: A
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: EXECUTION       TICK:    1 PC:  4112 ADDR:     4 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: PRINT
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: COMMAND_FETCH   TICK:    2 PC:  4112 ADDR:     4 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: fetch
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: OPERAND_FETCH   TICK:    2 PC:  4112 ADDR:     4 MEM[ADDR]:          1 ACC:          0 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: LOAD_CONST 2
    DEBUG root:processor.py:798 Tick 2 PC 4112: LOAD_CONST 2 ACC=0 SP=64192 FSP=64512 CP=65536
    DEBUG root:processor.py:695 STATE: RUNNING    STEP: EXECUTION       TICK:    2 PC:  4120 ADDR:     6 MEM[ADDR]:          0 ACC:          2 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: LOAD_CONST 2
    DEBUG root:processor.py:695 STATE: PAUSED     STEP: PAUSE_CHECK     TICK:    3 PC:  4120 ADDR:     6 MEM[ADDR]:          0 ACC:          2 SP: 64192 FSP: 64512 CP: 65536 ISP: 64256 heap_ptr:  1038 C: 0 V: 0	INSTR: pause
