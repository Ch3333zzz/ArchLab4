name: sort
config: 
  lenient_log: true
source:
  language: lisp
  code: |
    (setq arr (alloc 5))
    (setq n 5)

    (setq i 0)
    (while (< i n)
      (if (= i 0) (aset arr 0 42)
        (if (= i 1) (aset arr 1 3)
          (if (= i 2) (aset arr 2 7)
            (if (= i 3) (aset arr 3 19)
              (aset arr 4 1)))))
      (setq i (+ i 1))
    )

    (setq i 0)
    (while (< i n)
      (setq j 0)
      (while (< j (- n i 1))
        (setq x (aget arr j))
        (setq y (aget arr (+ j 1)))
        (if (> x y)
          (progn
            (aset arr j y)
            (aset arr (+ j 1) x)
          )
        )
        (setq j (+ j 1))
      )
      (setq i (+ i 1))
    )

    (setq k 0)
    (while (< k n)
      (setq v (aget arr k))
      (print v)
      (if (< (+ k 1) n) (print " "))
      (setq k (+ k 1))
    )
    (print "\n")

expect:
  output: |
    1 3 7 19 42
  state: stopped
  error: false
  out_code_hex: |-
    0 - 05000054 - ALLOC 5
    4 - 00040016 - STORE_MEM 1024
    8 - 0500000A - LOAD_IMM 5
    12 - 01040016 - STORE_MEM 1025
    16 - 0000000A - LOAD_IMM 0
    20 - 02040016 - STORE_MEM 1026
    24 - 02040015 - LOAD_MEM 1026
    28 - 0000003C - PUSH_IMM 0
    32 - 01040015 - LOAD_MEM 1025
    36 - 0300005B - CMP_POP 3
    40 - 1C01001F - BEQZ 284
    44 - 02040015 - LOAD_MEM 1026
    48 - 0000003C - PUSH_IMM 0
    52 - 0000000A - LOAD_IMM 0
    56 - 0100005B - CMP_POP 1
    60 - 5C00001F - BEQZ 92
    64 - 00040015 - LOAD_MEM 1024
    68 - 0000003C - PUSH_IMM 0
    72 - 0000000A - LOAD_IMM 0
    76 - 0000003C - PUSH_IMM 0
    80 - 2A00000A - LOAD_IMM 42
    84 - 00000055 - ASET 0
    88 - 0401001E - JMP 260
    92 - 02040015 - LOAD_MEM 1026
    96 - 0000003C - PUSH_IMM 0
    100 - 0100000A - LOAD_IMM 1
    104 - 0100005B - CMP_POP 1
    108 - 8C00001F - BEQZ 140
    112 - 00040015 - LOAD_MEM 1024
    116 - 0000003C - PUSH_IMM 0
    120 - 0100000A - LOAD_IMM 1
    124 - 0000003C - PUSH_IMM 0
    128 - 0300000A - LOAD_IMM 3
    132 - 00000055 - ASET 0
    136 - 0401001E - JMP 260
    140 - 02040015 - LOAD_MEM 1026
    144 - 0000003C - PUSH_IMM 0
    148 - 0200000A - LOAD_IMM 2
    152 - 0100005B - CMP_POP 1
    156 - BC00001F - BEQZ 188
    160 - 00040015 - LOAD_MEM 1024
    164 - 0000003C - PUSH_IMM 0
    168 - 0200000A - LOAD_IMM 2
    172 - 0000003C - PUSH_IMM 0
    176 - 0700000A - LOAD_IMM 7
    180 - 00000055 - ASET 0
    184 - 0401001E - JMP 260
    188 - 02040015 - LOAD_MEM 1026
    192 - 0000003C - PUSH_IMM 0
    196 - 0300000A - LOAD_IMM 3
    200 - 0100005B - CMP_POP 1
    204 - EC00001F - BEQZ 236
    208 - 00040015 - LOAD_MEM 1024
    212 - 0000003C - PUSH_IMM 0
    216 - 0300000A - LOAD_IMM 3
    220 - 0000003C - PUSH_IMM 0
    224 - 1300000A - LOAD_IMM 19
    228 - 00000055 - ASET 0
    232 - 0401001E - JMP 260
    236 - 00040015 - LOAD_MEM 1024
    240 - 0000003C - PUSH_IMM 0
    244 - 0400000A - LOAD_IMM 4
    248 - 0000003C - PUSH_IMM 0
    252 - 0100000A - LOAD_IMM 1
    256 - 00000055 - ASET 0
    260 - 02040015 - LOAD_MEM 1026
    264 - 0000003C - PUSH_IMM 0
    268 - 0100000A - LOAD_IMM 1
    272 - 0100005A - BINOP_POP 1
    276 - 02040016 - STORE_MEM 1026
    280 - 1800001E - JMP 24
    284 - 0000000A - LOAD_IMM 0
    288 - 02040016 - STORE_MEM 1026
    292 - 02040015 - LOAD_MEM 1026
    296 - 0000003C - PUSH_IMM 0
    300 - 01040015 - LOAD_MEM 1025
    304 - 0300005B - CMP_POP 3
    308 - 2C02001F - BEQZ 556
    312 - 0000000A - LOAD_IMM 0
    316 - 03040016 - STORE_MEM 1027
    320 - 03040015 - LOAD_MEM 1027
    324 - 0000003C - PUSH_IMM 0
    328 - 01040015 - LOAD_MEM 1025
    332 - 0000003C - PUSH_IMM 0
    336 - 02040015 - LOAD_MEM 1026
    340 - 0200005A - BINOP_POP 2
    344 - 0000003C - PUSH_IMM 0
    348 - 0100000A - LOAD_IMM 1
    352 - 0200005A - BINOP_POP 2
    356 - 0300005B - CMP_POP 3
    360 - 1402001F - BEQZ 532
    364 - 00040015 - LOAD_MEM 1024
    368 - 0000003C - PUSH_IMM 0
    372 - 03040015 - LOAD_MEM 1027
    376 - 0000003C - PUSH_IMM 0
    380 - 00000056 - AGET 0
    384 - 04040016 - STORE_MEM 1028
    388 - 00040015 - LOAD_MEM 1024
    392 - 0000003C - PUSH_IMM 0
    396 - 03040015 - LOAD_MEM 1027
    400 - 0000003C - PUSH_IMM 0
    404 - 0100000A - LOAD_IMM 1
    408 - 0100005A - BINOP_POP 1
    412 - 0000003C - PUSH_IMM 0
    416 - 00000056 - AGET 0
    420 - 05040016 - STORE_MEM 1029
    424 - 04040015 - LOAD_MEM 1028
    428 - 0000003C - PUSH_IMM 0
    432 - 05040015 - LOAD_MEM 1029
    436 - 0500005B - CMP_POP 5
    440 - FC01001F - BEQZ 508
    444 - 00040015 - LOAD_MEM 1024
    448 - 0000003C - PUSH_IMM 0
    452 - 03040015 - LOAD_MEM 1027
    456 - 0000003C - PUSH_IMM 0
    460 - 05040015 - LOAD_MEM 1029
    464 - 00000055 - ASET 0
    468 - 00040015 - LOAD_MEM 1024
    472 - 0000003C - PUSH_IMM 0
    476 - 03040015 - LOAD_MEM 1027
    480 - 0000003C - PUSH_IMM 0
    484 - 0100000A - LOAD_IMM 1
    488 - 0100005A - BINOP_POP 1
    492 - 0000003C - PUSH_IMM 0
    496 - 04040015 - LOAD_MEM 1028
    500 - 00000055 - ASET 0
    504 - FC01001E - JMP 508
    508 - 03040015 - LOAD_MEM 1027
    512 - 0000003C - PUSH_IMM 0
    516 - 0100000A - LOAD_IMM 1
    520 - 0100005A - BINOP_POP 1
    524 - 03040016 - STORE_MEM 1027
    528 - 4001001E - JMP 320
    532 - 02040015 - LOAD_MEM 1026
    536 - 0000003C - PUSH_IMM 0
    540 - 0100000A - LOAD_IMM 1
    544 - 0100005A - BINOP_POP 1
    548 - 02040016 - STORE_MEM 1026
    552 - 2401001E - JMP 292
    556 - 0000000A - LOAD_IMM 0
    560 - 06040016 - STORE_MEM 1030
    564 - 06040015 - LOAD_MEM 1030
    568 - 0000003C - PUSH_IMM 0
    572 - 01040015 - LOAD_MEM 1025
    576 - 0300005B - CMP_POP 3
    580 - AC02001F - BEQZ 684
    584 - 00040015 - LOAD_MEM 1024
    588 - 0000003C - PUSH_IMM 0
    592 - 06040015 - LOAD_MEM 1030
    596 - 0000003C - PUSH_IMM 0
    600 - 00000056 - AGET 0
    604 - 07040016 - STORE_MEM 1031
    608 - 07040015 - LOAD_MEM 1031
    612 - 00000046 - PRINT
    616 - 06040015 - LOAD_MEM 1030
    620 - 0000003C - PUSH_IMM 0
    624 - 0100000A - LOAD_IMM 1
    628 - 0100005A - BINOP_POP 1
    632 - 0000003C - PUSH_IMM 0
    636 - 01040015 - LOAD_MEM 1025
    640 - 0300005B - CMP_POP 3
    644 - 9402001F - BEQZ 660
    648 - 00000014 - LOAD_CONST 0
    652 - 00000046 - PRINT
    656 - 9402001E - JMP 660
    660 - 06040015 - LOAD_MEM 1030
    664 - 0000003C - PUSH_IMM 0
    668 - 0100000A - LOAD_IMM 1
    672 - 0100005A - BINOP_POP 1
    676 - 06040016 - STORE_MEM 1030
    680 - 3402001E - JMP 564
    684 - 02000014 - LOAD_CONST 2
    688 - 00000046 - PRINT
    692 - 00000001 - HALT
  out_log: |
    DEBUG root:processor.py:197 Datapath: heap_ptr initialized to word 1206
    DEBUG root:processor.py:616 No more scheduled input and mmio_in_buffer empty -> input closed (EOF)
    DEBUG root:processor.py:1015 ALLOC: allocated 5 words at base 1206 (new heap_ptr=1211)
    DEBUG root:processor.py:1036 ASET: wrote ACC=42 to word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1036 ASET: wrote ACC=3 to word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1036 ASET: wrote ACC=7 to word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1036 ASET: wrote ACC=19 to word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1036 ASET: wrote ACC=1 to word 1210 (base=1206 idx=4)
    DEBUG root:processor.py:1057 AGET: loaded ACC=42 from word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1057 AGET: loaded ACC=3 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1036 ASET: wrote ACC=3 to word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1036 ASET: wrote ACC=42 to word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=42 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1036 ASET: wrote ACC=7 to word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1036 ASET: wrote ACC=42 to word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1057 AGET: loaded ACC=42 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1057 AGET: loaded ACC=19 from word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1036 ASET: wrote ACC=19 to word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1036 ASET: wrote ACC=42 to word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1057 AGET: loaded ACC=42 from word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1057 AGET: loaded ACC=1 from word 1210 (base=1206 idx=4)
    DEBUG root:processor.py:1036 ASET: wrote ACC=1 to word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1036 ASET: wrote ACC=42 to word 1210 (base=1206 idx=4)
    DEBUG root:processor.py:1057 AGET: loaded ACC=3 from word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=19 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1057 AGET: loaded ACC=19 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1057 AGET: loaded ACC=1 from word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1036 ASET: wrote ACC=1 to word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1036 ASET: wrote ACC=19 to word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1057 AGET: loaded ACC=3 from word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=1 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1036 ASET: wrote ACC=1 to word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1036 ASET: wrote ACC=7 to word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1057 AGET: loaded ACC=3 from word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1057 AGET: loaded ACC=1 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1036 ASET: wrote ACC=1 to word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1036 ASET: wrote ACC=3 to word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1057 AGET: loaded ACC=1 from word 1206 (base=1206 idx=0)
    DEBUG root:processor.py:1095 PRINT: numeric -> 1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:1086 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1057 AGET: loaded ACC=3 from word 1207 (base=1206 idx=1)
    DEBUG root:processor.py:1095 PRINT: numeric -> 3
    DEBUG root:processor.py:320 [MMIO OUT] wrote 51 -> char: 3
    DEBUG root:processor.py:1086 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1057 AGET: loaded ACC=7 from word 1208 (base=1206 idx=2)
    DEBUG root:processor.py:1095 PRINT: numeric -> 7
    DEBUG root:processor.py:320 [MMIO OUT] wrote 55 -> char: 7
    DEBUG root:processor.py:1086 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1057 AGET: loaded ACC=19 from word 1209 (base=1206 idx=3)
    DEBUG root:processor.py:1095 PRINT: numeric -> 19
    DEBUG root:processor.py:320 [MMIO OUT] wrote 49 -> char: 1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 57 -> char: 9
    DEBUG root:processor.py:1086 PRINT: Detected pstr at 0 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 32 -> char:  
    DEBUG root:processor.py:1057 AGET: loaded ACC=42 from word 1210 (base=1206 idx=4)
    DEBUG root:processor.py:1095 PRINT: numeric -> 42
    DEBUG root:processor.py:320 [MMIO OUT] wrote 52 -> char: 4
    DEBUG root:processor.py:320 [MMIO OUT] wrote 50 -> char: 2
    DEBUG root:processor.py:1086 PRINT: Detected pstr at 2 len=1
    DEBUG root:processor.py:320 [MMIO OUT] wrote 10 -> char: 

    DEBUG root:processor.py:725 HALT encountered
